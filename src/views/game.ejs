<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Buzzer Game – <%= username %>
	</title>
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">

	<style>
		:root {
			--bg: #0e0e0e;
			--fg: #f1f1f1;
			--accent: #00ffcc;
			--hover: #00e6b8;
			--danger: #ff4d4d;
		}

		body {
			background-color: var(--bg);
			color: var(--fg);
			font-family: 'Orbitron', sans-serif;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			min-height: 100vh;
			margin: 0;
			padding: 2rem 1rem;
			text-align: center;
		}

		h1 {
			font-size: 2.5rem;
			margin-bottom: 0.5em;
			color: var(--accent);
		}

		#status {
			font-size: 1.5rem;
			color: var(--accent);
			margin-bottom: 1em;
		}

		#playerList {
			margin-bottom: 1.5em;
			font-size: 1.1rem;
			color: #aaa;
		}

		#startBtn {
			background-color: #222;
			color: var(--accent);
			border: 2px solid var(--accent);
			font-size: 1rem;
			padding: 0.7rem 1.5rem;
			border-radius: 10px;
			cursor: pointer;
			transition: all 0.2s ease-in-out;
			margin-bottom: 2rem;
		}

		#startBtn:hover {
			background-color: var(--accent);
			color: #000;
		}

		#buzzerContainer {
			margin-top: 2rem;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		#tapBtn {
			width: 180px;
			height: 180px;
			border-radius: 50%;
			background: radial-gradient(circle at 30% 30%, var(--danger), #b30000);
			border: none;
			box-shadow: 0 0 40px var(--danger), inset 0 0 15px #660000;
			color: white;
			font-size: 1.8rem;
			font-weight: bold;
			cursor: pointer;
			transition: transform 0.1s ease, box-shadow 0.1s ease;
		}

		#tapBtn:active {
			transform: scale(0.96);
			box-shadow: 0 0 12px var(--danger), inset 0 0 5px #330000;
		}

		#tapBtn:disabled {
			background: radial-gradient(circle at 30% 30%, #8b0000, #4d0000);
			box-shadow: none;
			color: #888;
			cursor: not-allowed;
		}

		footer {
			margin-top: 3rem;
			font-size: 0.85rem;
			color: #444;
		}
	</style>
</head>

<body>
	<h1>Hi, <%= username %>!</h1>

	<div id="status">Connecting...</div>
	<div id="playerList">Players: waiting...</div>

	<button id="startBtn">Start Game</button>

	<div id="buzzerContainer">
		<button id="tapBtn" disabled>🚨 TAP</button>
	</div>

	<footer>Be the fastest to buzz in.</footer>

	<script>
		const username = "<%= username %>";
		const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
		const ws = new WebSocket(`${protocol}//${window.location.host}/?username=${username}`);

		const status = document.getElementById('status');
		const playerList = document.getElementById('playerList');
		const tapBtn = document.getElementById('tapBtn');
		const startBtn = document.getElementById('startBtn');

		ws.onmessage = (event) => {
			const data = JSON.parse(event.data);

			switch (data.type) {
				case 'gameState':
					status.innerText = `Game state: ${data.state}`;
					break;
				case 'players':
					playerList.innerText = `Players: ${data.players.join(', ')}`;
					break;
				case 'gameStart':
					status.innerText = `Get ready... ${data.countdown}`;
					startBtn.disabled = true;
					break;
				case 'countdown':
					status.innerText = `Starting in... ${data.count}`;
					break;
				case 'gameActive':
					status.innerText = '🚀 GO! TAP NOW!';
					tapBtn.disabled = false;
					break;
				case 'winner':
					status.innerText = `🏆 ${data.winner} won the game!`;
					tapBtn.disabled = true;
					startBtn.disabled = false;
					break;
				case 'gameReset':
					status.innerText = 'Game reset.';
					tapBtn.disabled = true;
					startBtn.disabled = false;
					break;
			}
		};

		tapBtn.onclick = () => {
			ws.send(JSON.stringify({type: 'tap', username: username, timestamp: Date.now()}));
		};

		startBtn.onclick = () => {
			ws.send(JSON.stringify({type: 'startGame'}));
		};
	</script>
</body>

</html>
